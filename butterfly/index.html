<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Butterfly Emergence</title>
    <style>
        body { margin: 0; overflow: hidden; background: #121212; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        
        #ui-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            pointer-events: none;
            letter-spacing: 1px;
        }

        .hint {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            color: #fff;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }
    </style>
</head>
<body>

    <div id="ui-overlay">
        <h2>THE ENCHANTED JOURNAL</h2>
    </div>
    <div class="hint">Click anywhere to release the butterfly</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // 1. SCENE SETUP
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true; // Enable shadows for realism
        document.body.appendChild(renderer.domElement);

        // 2. LIGHTING
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        const spotLight = new THREE.SpotLight(0xffffff, 1);
        spotLight.position.set(5, 10, 5);
        spotLight.castShadow = true;
        scene.add(spotLight);

        // 3. THE BOOK (The Base)
        const bookGeometry = new THREE.BoxGeometry(6, 0.2, 8);
        const bookMaterial = new THREE.MeshStandardMaterial({ color: 0x3d2b1f }); // Leather cover
        const book = new THREE.Mesh(bookGeometry, bookMaterial);
        book.receiveShadow = true;
        scene.add(book);

        // The Page
        const pageGeo = new THREE.PlaneGeometry(5.5, 7.5);
        const pageMat = new THREE.MeshStandardMaterial({ color: 0xf5f5dc }); // Parchment
        const page = new THREE.Mesh(pageGeo, pageMat);
        page.rotation.x = -Math.PI / 2;
        page.position.y = 0.11;
        page.receiveShadow = true;
        scene.add(page);

        // 4. THE BUTTERFLY (3D Groups)
        const butterfly = new THREE.Group();
        
        const wingShape = new THREE.PlaneGeometry(1.2, 1.8);
        const wingMat = new THREE.MeshStandardMaterial({ 
            color: 0x00d4ff, 
            side: THREE.DoubleSide,
            emissive: 0x004466,
            roughness: 0.3,
            metalness: 0.5
        });

        const leftWing = new THREE.Mesh(wingShape, wingMat);
        const rightWing = new THREE.Mesh(wingShape, wingMat);

        // Offset geometry so wings rotate from the center "body"
        leftWing.geometry.translate(-0.6, 0, 0);
        rightWing.geometry.translate(0.6, 0, 0);
        
        leftWing.castShadow = true;
        rightWing.castShadow = true;

        butterfly.add(leftWing);
        butterfly.add(rightWing);
        butterfly.position.set(0, 0.15, 0); // Sit just above the page
        scene.add(butterfly);

        camera.position.set(0, 6, 8);
        camera.lookAt(0, 0, 0);

        // 5. ANIMATION LOGIC
        let isFlying = false;
        let clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getElapsedTime();

            if (isFlying) {
                // Flapping Animation
                const flapSpeed = 12;
                leftWing.rotation.y = Math.sin(delta * flapSpeed) * 1.2;
                rightWing.rotation.y = -Math.sin(delta * flapSpeed) * 1.2;

                // Lift-off and Flight Path
                butterfly.position.y += 0.03;
                butterfly.position.z -= 0.02;
                butterfly.position.x = Math.sin(delta * 2) * 2; // Slight swaying
                
                // Rotate to face flight direction
                butterfly.rotation.z = Math.sin(delta * 2) * 0.2;
            } else {
                // Subtle "breathing" movement while on page
                leftWing.rotation.y = Math.sin(delta * 2) * 0.1;
                rightWing.rotation.y = -Math.sin(delta * 2) * 0.1;
            }

            renderer.render(scene, camera);
        }

        // Interaction
        window.addEventListener('mousedown', () => {
            isFlying = true;
            document.querySelector('.hint').style.display = 'none';
        });

        // Responsive Resizing
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>